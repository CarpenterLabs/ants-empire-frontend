<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Uniswap V2 Pair Reserves</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <style>
      .chart-container {
        max-width: 600px;
        margin: 2rem auto;
      }
    </style>
  </head>
  <body>
    <h1>Uniswap V2 Pair Reserves</h1>
    <div class="chart-container">
      <canvas id="chart1"></canvas>
    </div>
    <div class="chart-container">
      <canvas id="chart2"></canvas>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        const provider = new ethers.providers.JsonRpcProvider("https://ganache.campihome.cloud/"); 
        
        const pools = [
          {
            pairAddress: "0x634749943A5Bb0bddF6e3AeB06C19dd7cA9634a1",
            tokenA: "0x254dffcd3277C0b1660F6d42EFbB754edaBAbC2B",
            tokenB: "0xCfEB869F69431e42cdB54A4F4f105C19C080A601",
            chartId: "chart1"
          },
          {
            pairAddress: "0x74Ab4F7B77859f0Cc0769792E70FB0cb1E4D1C89",
            tokenA: "0x254dffcd3277C0b1660F6d42EFbB754edaBAbC2B",
            tokenB: "0x5b1869D9A4C187F2EAa108f3062412ecf0526b24",
            chartId: "chart2"
          }
        ];

        const uniswapV2PairAbi = [
          "function getReserves() external view returns (uint112 reserve0, uint112 reserve1, uint32 blockTimestampLast)",
          "function token0() external view returns (address)",
          "function token1() external view returns (address)"
        ];

        const erc20Abi = [
          "function decimals() view returns (uint8)",
          "function symbol() view returns (string)"
        ];

        for (const pool of pools) {
          const pairContract = new ethers.Contract(pool.pairAddress, uniswapV2PairAbi, provider);
          const tokenAContract = new ethers.Contract(pool.tokenA, erc20Abi, provider);
          const tokenBContract = new ethers.Contract(pool.tokenB, erc20Abi, provider);

          const [reserve0, reserve1] = await getPairReserves(pairContract);
          const [tokenADecimals, tokenASymbol] = await getTokenInfo(tokenAContract);
          const [tokenBDecimals, tokenBSymbol] = await getTokenInfo(tokenBContract);

          const adjustedReserveA = parseFloat(ethers.utils.formatUnits(reserve0, tokenADecimals));
          const adjustedReserveB = parseFloat(ethers.utils.formatUnits(reserve1, tokenBDecimals));

          renderChart(pool.chartId, [tokenASymbol, tokenBSymbol], [adjustedReserveA, adjustedReserveB]);
        }

        async function getPairReserves(pair) {
          const [res0, res1, _] = await pair.getReserves();
          return [res0, res1];
        }

        async function getTokenInfo(tokenContract) {
          const decimals = await tokenContract.decimals();
          const symbol = await tokenContract.symbol();
          return [decimals, symbol];
        }

        function renderChart(chartId, labels, data) {
          const ctx = document.getElementById(chartId).getContext("2d");
          new Chart(ctx, {
            type: "bar",
            data: {
              labels: labels,
              datasets: [{
                label: "Pool Reserves",
                data: data,
                backgroundColor: "rgba(54, 162, 235, 0.2)",
                borderColor: "rgba(54, 162, 235, 1)",
                borderWidth: 1
              }]
            },
            options: {
              plugins: {
                datalabels: {
                  color: "#000",
                  anchor: "end",
                  align: "end",
                  formatter: (value) => value.toFixed(2),
                  font: { weight: "bold" }
                }
              },
              scales: {
                y: {
                  beginAtZero: true,
                  title: { display: true, text: "Reserves" }
                },
                x: {
                  title: { display: true, text: "Tokens" }
                }
              }
            },
            plugins: [ChartDataLabels]
          });
        }
      });
    </script>
  </body>
</html>